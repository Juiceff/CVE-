# CVE-2014-6271：shellshock漏洞复现   (朱俊峰 045)
## 一、漏洞分析
* ShellShock是刚刚曝光的一个BashShell漏洞（据说不仅仅是Bash，其他shell也可能有这个漏洞）
* 按照一般情况来说，系统里面的Shell是有严格的权限控制的，如果没有相应的权限，是根本看不到某些命令的存在，更不要说执行这些命令
* 但是，Bash在运行的过程中会调用操作系统的环境变量，并且会执行一些设置命令。通过ShellShock漏洞，入侵者可以把某些”本来没有权限执行的语句或者命令“，注入到环境变量里。当bash设置环境变量的时候，就会执行这些”被注入“命令。这样子便绕过用户权限的限制，把一些”没有权限执行的命令“，变成”具有执行权限的命令“了。从而可以在系统内任意执行Bash命令语句，胡作非为（相当于获得root超级用户权限）。
## 二、复现环境
* kali，在虚拟机里运行，bash版本如下：
![](https://github.com/Juiceff/picture/blob/master/shellshock/1.png)
**如果bash版本不是低于4.1可通过如下步骤修改**
```c
wget http://labfile.oss.aliyuncs.com/bash-4.1.tar.gz
tar xf bash-4.1.tar.gz
cd bash-4.1
./configure
make
make install
rm /bin/bash
#ln -s /usr/local/bin/bash /bin/bash  //建立软链接
```
### 检查是否存在漏洞
![](https://github.com/Juiceff/picture/blob/master/shellshock/1.png)
## 三、复现过程
### 创建shock.c文件并进行编译
```c
#include <stdio.h>
void main()
{
setuid(geteuid());
system("/bin/ps -a");
}
```
### 进入juice用户，实现root提权攻击
1. 定义环境变量，把`bash`命令嵌套进去   
2. 运行shock  
3. 进入了root权限   
![](https://github.com/Juiceff/picture/blob/master/shellshock/3.png)
### 原理解释
**1. system()函数将调用“/bin/sh -c”，让/bin/sh指向/bin/bash   
2. setuid(geteuid())：read uid = effective uid**
